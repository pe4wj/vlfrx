# vlfrx
VLF receiver for the Teensy MCU + audio shield.

Having visited Grimeton radio station (SAQ) in Sweden in August 2019, I came up with the idea to build a dedicated receiver.

Inspired by SAQRX by SM6LKM (https://sites.google.com/site/sm6lkm/saqrx/) but I did not want to use the PC for this. Instead, I opted for using a Teensy 4.0 MCU and its companion audio shield.

Instead of using complex low pass filters as done in SAQRX, the complex multiplication is done after the I and Q filters. This is essentially Weaver's method of single sideband demodulation.

![Optional Text](../master/vlfrx.png)

The initial signal processing code has been generated by the excellent Teensy Audio System Design tool (https://www.pjrc.com/teensy/gui/) - note that the AGC and FFT were added later in code and is not shown here, but the diagram shows how the receiver works conceptually.

![Optional Text](../master/audio_design_tool.png)

The Teensy audio library contains a wealth of signal processing functions. There is no direct function for generation of a cosine wave, however phase can be specified. Therefore, the cosine signals are made by generating a sine wave with a phase of 90 degrees. A very crude AGC has been included to protect the listener's ears. This basically divides the signal amplitude by the measured RMS value over a number of samples (by using a peak detector from the audio library) and includes fast attack and slow decay. The AGC output sets the volume of the audio codec. Since the AGC is feed-forward, and peak detection samples are only available every 128 samples, a 10 msec delay is included before sending the samples to the audio codec. This ensures that the AGC is never too late, yet it introduces an additional 10 msec latency which is fully acceptable in this application.

The Teensy + audio shield was built into a small enclosure including a TDA2822 audio amplifier, OLED display and rotary encoder. The small box to the right is an active ("E-field probe") antenna based on a BF245 JFET which is biased by the microphone bias voltage coming from the audio shield. The actual antenna is a wire of approx 25 cm formed into a loop and soldered into a 2 mm banana socket. The antenna contains a "ground" terminal for attaching a ground wire. Normally, holding the antenna in the air while touching the metal audio connector shield provides plenty of signal.

![Optional Text](../master/vlfrx.jpg)


The E-field probe circuit can be found below and is surprisingly straightforward, since an electret microphone is electrically very similar to an E-field probe as it also contains a JFET. Since the active component used is a depletion mode JFET, it works ok without a gate bias provided the actual probe is not too large, thereby ensuring that the device operates linearly. The 10 M resistor provides a static bleed path and acts as a high pass filter with the 560 pF and the antenna series capacitance. The 150 k resistor forms a low pass filter combined with the gate-source capacitance of the JFET. For a BF245 JFET, C_gs is approx 3 pF, yielding a corner frequency of approximately 354 kHz. This helps to keep strong medium wave signals from causing non-linear distortion. The 2k2 resistor is there to allow biasing from a PC soundcard microphone input (needs a stereo audio cable). With the Teensy audio shield, a mono cable can be used.

![Optional Text](../master/antenna.png)
